- name: Build origin
  block:
    - name: Remove existing origin
      file:
        path: /root/containers/origin
        state: absent

    - name: Create program directory
      file:
        path: /root/containers/origin
        state: directory

    - name: Copy program folder
      synchronize:
        src: ../origin/
        dest: /root/containers/origin
        rsync_opts:
          - "--exclude=node_modules/"
          - "--exclude=yarn.lock"
          - "--exclude=package-lock.json"
          - "--exclude=.git"
    - name: Copy user config
      copy:
        src: ./user_config.yml
        dest: /root/containers/origin/config/user_config.yml

    - name: Build image
      shell: docker build -t origin -f Dockerfile .
      args:
          chdir: /root/containers/origin